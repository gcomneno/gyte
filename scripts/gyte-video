#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 1 ]; then
  echo "Uso: $0 URL_YOUTUBE [ALTRI_ARG_YT_DLP...]" >&2
  echo "Esempio: $0 'https://www.youtube.com/watch?v=XXXX'" >&2
  exit 1
fi

URL="$1"
shift || true

# Formato di output del container video
# Default storico: mp4
# Puoi cambiare via env:
#   GYTE_VIDEO_FORMAT=mkv gyte-video ...
VIDEO_FORMAT="${GYTE_VIDEO_FORMAT:-mp4}"

echo ">> Video container: $VIDEO_FORMAT"

# Scarica il miglior video+audio possibile e li unisce nel formato richiesto
# (remux con ffmpeg, niente ricompressione se non necessario)

yt-dlp \
  --yes-playlist \
  -f "bv*+ba/best" \
  --merge-output-format "$VIDEO_FORMAT" \
  --no-embed-subs \
  -o "%(uploader)s - %(title).80s [%(id)s].%(ext)s" \
  "$URL" "$@"
